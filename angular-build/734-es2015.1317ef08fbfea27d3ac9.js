"use strict";(self.webpackChunkmultikart_backend=self.webpackChunkmultikart_backend||[]).push([[734],{13734:function(e,t,r){r.r(t),r.d(t,{OrdersModule:function(){return I}});var o=r(38583),s=r(90665),i=r(15834),n=r(61861),a=r(70429),l=r(93291),d=r(10494),u=r(98616),c=r(37716),m=r(8403);let h=(()=>{class e{constructor(e){this.httpClient=e,this.url="/api/order"}get(e){return this.httpClient.getObservable(this.url,e).toPromise()}getDetails(e){return this.httpClient.getObservable(this.url+"-detail",e).toPromise()}getByStatus(e,t){return this.httpClient.getObservable(this.url+"/by-status?status="+t,e).toPromise()}create(e){return this.httpClient.postObservable(this.url,e).toPromise()}update(e){return this.httpClient.putObservable(this.url,e).toPromise()}delete(e){return this.httpClient.deleteObservable(`${this.url}?id=${null==e?void 0:e.id}`).toPromise()}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(m.Y))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac}),e})();var p=r(58676),v=r(59314),g=r(97582);class b{constructor(){this.firstName="",this.lastName="",this.address="",this.phone="",this.email="",this.note="",this.status="New",this.totalAmount=0,this.totalItem=0,this.orderDetails=[]}}let f=(()=>{class e{constructor(e){this.httpClient=e,this.url="/api/order-detail"}get(e){return this.httpClient.getObservable(this.url,e).toPromise()}create(e){return this.httpClient.postObservable(this.url,e).toPromise()}update(e){return this.httpClient.putObservable(this.url,e).toPromise()}delete(e){return this.httpClient.deleteObservable(`${this.url}?id=${e}`).toPromise()}getByOrder(e,t){return this.httpClient.getObservable(`${this.url}/order?id=${e}`,t).toPromise()}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(m.Y))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac}),e})();var A=r(18217),Z=r(5383),q=r(88259),C=r.n(q),T=r(20985),y=r(71279),O=r(36711);function F(e,t){1&e&&(c.TgZ(0,"span",21),c._uU(1," Full Name is required "),c.qZA())}function S(e,t){1&e&&(c.TgZ(0,"span",21),c._uU(1," Address is required "),c.qZA())}function N(e,t){1&e&&(c.TgZ(0,"span",21),c._uU(1," Email is required "),c.qZA())}function x(e,t){1&e&&(c.TgZ(0,"span",21),c._uU(1," Phone is required "),c.qZA())}let U=(()=>{class e{constructor(e,t,r,o,s){this.formBuilder=e,this.ngbActiveModal=t,this.ordersService=r,this.orderDetailsService=o,this.messageService=s,this.order=new b,this.submitted=!1,this.settings={mode:"external",actions:!1,columns:{productImgUrl:{title:"Image",type:"custom",renderComponent:A.V},productName:{title:"Product Name"},price:{title:"Price",value:"price",type:"custom",renderComponent:p.x},quantity:{title:"Quantity",value:"quantity",type:"custom",renderComponent:v.V},totalAmount:{title:"Total Amount",value:"totalAmount",type:"custom",renderComponent:p.x}}}}ngOnInit(){this.loadFormItem(),this.createModal(),this.getOrderDetails()}loadFormItem(){var e="Rejected"==this.item.status;this.orderForm=this.formBuilder.group({fullName:[{value:this.item.fullName,disabled:e},s.kI.required],address:[{value:this.item.address,disabled:e},s.kI.required],email:[{value:this.item.email,disabled:e},s.kI.required],phone:[{value:this.item.phone,disabled:e},s.kI.required],status:[{value:this.item.status,disabled:!0},s.kI.required]})}createModal(){this.modalHeader=new Z.IQ,this.modalHeader.title="Update Order",this.modalFooter=new Z.Jt,this.modalFooter.buttons=[{color:"btn btn-primary",title:"close",onAction:e=>{this.ngbActiveModal.dismiss()}}],"New"==this.item.status&&(this.modalFooter.buttons=[{color:"btn btn-info",title:"save",onAction:e=>{this.save()}},{color:"btn btn-success",title:"approve",onAction:e=>{this.approve()}},{color:"btn btn-primary",title:"reject",onAction:e=>{this.reject()}}]),"Approved"==this.item.status&&(this.modalFooter.buttons=[{color:"btn btn-info",title:"save",onAction:e=>{this.save()}},{color:"btn btn-primary",title:"close",onAction:e=>{this.ngbActiveModal.dismiss()}}])}get orderFormControl(){return this.orderForm.controls}loadOrderModel(){this.order={fullName:this.orderForm.controls.fullName.value,address:this.orderForm.controls.address.value,email:this.orderForm.controls.email.value,phone:this.orderForm.controls.phone.value,status:this.item.status,id:this.item.id,totalAmount:this.item.totalAmount,totalItem:this.item.totalItem}}save(){this.loadOrderModel(),this.submitted=!0,this.orderForm.valid&&this.ordersService.update(this.order).then(()=>{this.messageService.notification("Order has been edited",u.b.SUCCESS)}).catch(e=>{var t,r;this.messageService.alert(null!==(r=null!==(t=e.error.message)&&void 0!==t?t:JSON.stringify(e.error.error))&&void 0!==r?r:"Server Disconnected",u.b.ERROR)})}approve(){this.loadOrderModel(),this.order.status="Approved",this.messageService.confirm("Do you want to approve the order?","Yes","No",!1).then(e=>(0,g.mG)(this,void 0,void 0,function*(){e.isConfirmed&&(this.submitted=!0,this.orderForm.valid&&this.ordersService.update(this.order).then(()=>{this.messageService.notification("Order has been approved",u.b.SUCCESS),this.ngbActiveModal.close()}).catch(e=>{var t,r;this.messageService.alert(null!==(r=null!==(t=e.error.message)&&void 0!==t?t:JSON.stringify(e.error.error))&&void 0!==r?r:"Server Disconnected",u.b.ERROR)}))}))}reject(){this.loadOrderModel(),this.order.status="Rejected",C().fire({title:"Do you want to reject the order?",input:"text",inputPlaceholder:"Why?",showCancelButton:!0,confirmButtonText:"Yes",icon:"question"}).then(e=>(0,g.mG)(this,void 0,void 0,function*(){e.isConfirmed&&(this.submitted=!0,this.order.note=e.value,console.log(e.value),this.orderForm.valid&&this.ordersService.update(this.order).then(e=>{this.messageService.notification("Order has been rejected",u.b.SUCCESS),this.ngbActiveModal.close()}).catch(e=>{var t,r;this.messageService.alert(null!==(r=null!==(t=e.error.message)&&void 0!==t?t:JSON.stringify(e.error.error))&&void 0!==r?r:"Server Disconnected",u.b.ERROR)}))}))}getOrderDetails(){this.orderDetailsService.getByOrder(this.item.id,null).then(e=>{e.hasError||(this.orderDetails=e.data)}).catch(e=>{var t,r;this.messageService.alert(null!==(r=null!==(t=e.error.message)&&void 0!==t?t:JSON.stringify(e.error.error))&&void 0!==r?r:"Server Disconnected",u.b.ERROR)})}close(e){this.ngbActiveModal.dismiss()}}return e.\u0275fac=function(t){return new(t||e)(c.Y36(s.qu),c.Y36(i.Kz),c.Y36(h),c.Y36(f),c.Y36(T.e))},e.\u0275cmp=c.Xpm({type:e,selectors:[["app-update-order"]],features:[c._Bn([h,f])],decls:53,vars:10,consts:[[3,"data","onAction"],[1,"container-fluid"],[1,"row"],[1,"col-sm-12"],[1,"card","tab2-card"],[1,"card-body"],["id","account","role","tabpanel","aria-labelledby","account-tab",1,"tab-pane","fade","active","show"],["novalidate","",1,"needs-validation","user-add",3,"formGroup"],[1,"form-group","row"],[1,"col-xl-3","col-md-4"],["type","text","required","","formControlName","fullName",1,"form-control","col-xl-8","col-md-7"],["class","text-danger",4,"ngIf"],["type","text","required","","formControlName","address",1,"form-control","col-xl-8","col-md-7"],["type","text","required","","formControlName","email",1,"form-control","col-xl-8","col-md-7"],["type","text","required","","formControlName","phone",1,"form-control","col-xl-8","col-md-7"],["type","text","required","","formControlName","status","readonly","",1,"form-control","col-xl-8","col-md-7"],[1,"col-12"],[1,"vendor-table"],["id","batchDelete",1,"custom-datatable","media-datatable"],[1,"table-responsive"],[3,"settings","source","sourceChange"],[1,"text-danger"]],template:function(e,t){1&e&&(c.TgZ(0,"app-modal-header",0),c.NdJ("onAction",function(e){return t.close(e)}),c.qZA(),c.TgZ(1,"div",1),c.TgZ(2,"div",2),c.TgZ(3,"div",3),c.TgZ(4,"div",4),c.TgZ(5,"div",5),c.TgZ(6,"div",6),c.TgZ(7,"form",7),c.TgZ(8,"h4"),c._uU(9),c.qZA(),c.TgZ(10,"div",8),c.TgZ(11,"label",9),c.TgZ(12,"span"),c._uU(13,"*"),c.qZA(),c._uU(14," Full Name"),c.qZA(),c._UZ(15,"input",10),c.YNc(16,F,2,0,"span",11),c.qZA(),c.TgZ(17,"div",8),c.TgZ(18,"label",9),c.TgZ(19,"span"),c._uU(20,"*"),c.qZA(),c._uU(21," Address"),c.qZA(),c._UZ(22,"input",12),c.YNc(23,S,2,0,"span",11),c.qZA(),c.TgZ(24,"div",8),c.TgZ(25,"label",9),c.TgZ(26,"span"),c._uU(27,"*"),c.qZA(),c._uU(28," Email"),c.qZA(),c._UZ(29,"input",13),c.YNc(30,N,2,0,"span",11),c.qZA(),c.TgZ(31,"div",8),c.TgZ(32,"label",9),c.TgZ(33,"span"),c._uU(34,"*"),c.qZA(),c._uU(35," Phone"),c.qZA(),c._UZ(36,"input",14),c.YNc(37,x,2,0,"span",11),c.qZA(),c.TgZ(38,"div",8),c.TgZ(39,"label",9),c.TgZ(40,"span"),c._uU(41,"*"),c.qZA(),c._uU(42," Status"),c.qZA(),c._UZ(43,"input",15),c.qZA(),c.qZA(),c.qZA(),c.TgZ(44,"div",2),c.TgZ(45,"div",16),c.TgZ(46,"label"),c._uU(47,"Order Details List"),c.qZA(),c.qZA(),c.TgZ(48,"div",17),c.TgZ(49,"div",18),c.TgZ(50,"div",19),c.TgZ(51,"ng2-smart-table",20),c.NdJ("sourceChange",function(e){return t.orderDetails=e}),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.TgZ(52,"app-modal-footer",0),c.NdJ("onAction",function(){return t.approve()}),c.qZA(),c.qZA()),2&e&&(c.Q6J("data",t.modalHeader),c.xp6(7),c.Q6J("formGroup",t.orderForm),c.xp6(2),c.hij("Order ",t.item.code,""),c.xp6(7),c.Q6J("ngIf",(t.orderFormControl.fullName.touched||t.submitted)&&(null==t.orderFormControl.fullName.errors?null:t.orderFormControl.fullName.errors.required)),c.xp6(7),c.Q6J("ngIf",(t.orderFormControl.address.touched||t.submitted)&&(null==t.orderFormControl.address.errors?null:t.orderFormControl.address.errors.required)),c.xp6(7),c.Q6J("ngIf",(t.orderFormControl.email.touched||t.submitted)&&(null==t.orderFormControl.email.errors?null:t.orderFormControl.email.errors.required)),c.xp6(7),c.Q6J("ngIf",(t.orderFormControl.phone.touched||t.submitted)&&(null==t.orderFormControl.phone.errors?null:t.orderFormControl.phone.errors.required)),c.xp6(14),c.Q6J("settings",t.settings)("source",t.orderDetails),c.xp6(1),c.Q6J("data",t.modalFooter))},directives:[y.R,s._Y,s.JL,s.sg,s.Fj,s.Q7,s.JJ,s.u,o.O5,n.T5,O.Y],styles:[""]}),e})();var M=r(46913);function _(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"app-paging-server-view",15),c.NdJ("page",function(t){return c.CHM(e),c.oxw().onPage(t)}),c.qZA()}if(2&e){const e=c.oxw();c.Q6J("data",e.data)}}const J=[{path:"",children:[{path:"list-orders",component:(()=>{class e{constructor(e,t,r,o){this.modalService=e,this.ordersService=t,this.datePipe=r,this.messageService=o,this.filter="",this.params={},this.isGetOrders=!1,this.settings={mode:"external",actions:{position:"right",add:!1,delete:!1},columns:{code:{title:"Code"},createByDate:{filter:!1,title:"Created Date",valuePrepareFunction:e=>this.datePipe.transform(new Date(e),"dd/MM/yyyy"),type:"custom",renderComponent:v.V},fullName:{title:"Full Name"},address:{title:"Address"},phone:{title:"Phone",type:"custom",renderComponent:v.V},email:{title:"Email"},status:{filter:!1,title:"Status"},note:{filter:!1,title:"Note"},hasCoupon:{filter:!1,title:"Coupon Applied",valuePrepareFunction:(e,t)=>e?t.couponName:""},totalAmount:{filter:!1,title:"Total Amount",value:"totalAmount",type:"custom",renderComponent:p.x}}},this.params.pageIndex=0}ngOnInit(){this.actionFilter("New")}getOrders(){this.isGetOrders=!1,this.ordersService.get({params:this.params}).then(e=>{e.hasError||(this.data=e.data,this.orders=e.data.results,this.orders.forEach(e=>{e.hasCoupon=!1,e.couponCode&&(e.hasCoupon=!0)}))}).catch(e=>{e.error.hasError&&console.log(e.error.message)})}openUpdate(e){var t=this.modalService.open(U,{size:"lg"});t.componentInstance.item=null==e?void 0:e.data,t.result.then(()=>this.getOrders(),e=>{})}statusFilter(e){this.isGetOrders=!0;let t=e.innerText.toUpperCase()!=="All".toUpperCase()?e.innerText:"";return e.classList.add("active"),this.filter==t||""==t?(this.filter="",this.params.pageIndex=0,this.getOrders()):(this.filter=t,this.actionFilter(t))}removeAllAction(...e){e.forEach(e=>e.classList.remove("active"))}actionFilter(e){this.ordersService.getByStatus(null,e).then(e=>{this.orders=e.data?e.data:[],this.orders.forEach(e=>{e.hasCoupon=!1,e.couponCode&&(e.hasCoupon=!0)})}).catch(e=>{var t,r;this.messageService.alert(null!==(r=null!==(t=e.error.message)&&void 0!==t?t:JSON.stringify(e.error.error))&&void 0!==r?r:"Server Disconnected",u.b.ERROR)})}onPage(e){this.params.pageIndex=e,this.getOrders()}}return e.\u0275fac=function(t){return new(t||e)(c.Y36(i.FF),c.Y36(h),c.Y36(o.uU),c.Y36(T.e))},e.\u0275cmp=c.Xpm({type:e,selectors:[["app-list-orders"]],features:[c._Bn([h,o.uU])],decls:27,vars:3,consts:[[1,"container-fluid"],[1,"card"],[1,"card-header"],[1,"card-body","vendor-table"],[1,"btn-group"],["type","button",1,"btn","btn-primary","btn-xs","mr-2",3,"click"],["allButton",""],["type","button",1,"btn","btn-primary","btn-xs","mr-2","active",3,"click"],["newButton",""],["approvedButton",""],["rejectedButton",""],["id","batchDelete",1,"custom-datatable","media-datatable"],[1,"table-responsive"],[3,"settings","source","sourceChange","edit"],[3,"data","page",4,"ngIf"],[3,"data","page"]],template:function(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"div",0),c.TgZ(1,"div",1),c.TgZ(2,"div",2),c.TgZ(3,"h5"),c._uU(4,"Order Details"),c.qZA(),c.qZA(),c.TgZ(5,"div",3),c.TgZ(6,"h6"),c.TgZ(7,"strong"),c._uU(8,"Order Status"),c.qZA(),c.qZA(),c.TgZ(9,"div",4),c.TgZ(10,"button",5,6),c.NdJ("click",function(){c.CHM(e);const r=c.MAs(11),o=c.MAs(14),s=c.MAs(17),i=c.MAs(20);return t.removeAllAction(r,o,s,i),t.statusFilter(r)}),c._uU(12," All "),c.qZA(),c.TgZ(13,"button",7,8),c.NdJ("click",function(){c.CHM(e);const r=c.MAs(11),o=c.MAs(14),s=c.MAs(17),i=c.MAs(20);return t.removeAllAction(r,o,s,i),t.statusFilter(o)}),c._uU(15," New "),c.qZA(),c.TgZ(16,"button",5,9),c.NdJ("click",function(){c.CHM(e);const r=c.MAs(11),o=c.MAs(14),s=c.MAs(17),i=c.MAs(20);return t.removeAllAction(r,o,s,i),t.statusFilter(s)}),c._uU(18," Approved "),c.qZA(),c.TgZ(19,"button",5,10),c.NdJ("click",function(){c.CHM(e);const r=c.MAs(11),o=c.MAs(14),s=c.MAs(17),i=c.MAs(20);return t.removeAllAction(r,o,s,i),t.statusFilter(i)}),c._uU(21," Rejected "),c.qZA(),c.qZA(),c.qZA(),c.TgZ(22,"div",3),c.TgZ(23,"div",11),c.TgZ(24,"div",12),c.TgZ(25,"ng2-smart-table",13),c.NdJ("sourceChange",function(e){return t.orders=e})("edit",function(e){return t.openUpdate(e)}),c.qZA(),c.qZA(),c.qZA(),c.YNc(26,_,1,1,"app-paging-server-view",14),c.qZA(),c.qZA(),c.qZA()}2&e&&(c.xp6(25),c.Q6J("settings",t.settings)("source",t.orders),c.xp6(1),c.Q6J("ngIf",!t.isGetOrders&&(null==t.data?null:t.data.totalPage)>1))},directives:[n.T5,o.O5,M.B],styles:["button.btn.btn-primary.active[_ngcontent-%COMP%]{background-color:#f93e44!important}"]}),e})(),data:{title:"Order List",breadcrumb:"Order List"}}]}];let w=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({imports:[[d.Bz.forChild(J)],d.Bz]}),e})(),I=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({providers:[l.jS],imports:[[o.ez,s.UX,i.IJ,n.ne,w,a.m]]}),e})()},59314:function(e,t,r){r.d(t,{V:function(){return s}});var o=r(37716);let s=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=o.Xpm({type:e,selectors:[["app-customViewCell"]],inputs:{value:"value",rowData:"rowData"},decls:2,vars:1,consts:[[1,"text-right"]],template:function(e,t){1&e&&(o.TgZ(0,"div",0),o._uU(1),o.qZA()),2&e&&(o.xp6(1),o.Oqu(t.value))},styles:[""]}),e})()}}]);